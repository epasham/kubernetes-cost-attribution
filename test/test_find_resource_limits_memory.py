import src.find
import unittest

class FindResourceLimitsMemory(unittest.TestCase):

    # A sample kube_pod_container_resource_limits_memory_dict
    kube_pod_container_resource_limits_memory_dict = [{'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'addon-resizer', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'kube-state-metrics-6d465b4b54-w552f'}, 'value': [1516052360.015, '31457280']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'alertmanager', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'alertmanager-6658498fb6-zrgsp'}, 'value': [1516052360.015, '536870912']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'butterfly', 'exported_namespace': 'garland', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'butterfly-1-nvc2t'}, 'value': [1516052360.015, '262144000']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'butterfly', 'exported_namespace': 'jason-monroe', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'butterfly-2-xcktw'}, 'value': [1516052360.015, '262144000']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'cluster-autoscaler', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'cluster-autoscaler-79ddf8fdbd-l28z5'}, 'value': [1516052360.015, '314572800']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'configmap-reload', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'alertmanager-6658498fb6-zrgsp'}, 'value': [1516052360.015, '10485760']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'configmap-reload', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'prometheus-54744d9cdb-4zdv6'}, 'value': [1516052360.015, '10485760']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'default-http-backend', 'exported_namespace': 'infrastructure', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'default-http-backend-59b65899db-w94k6'}, 'value': [1516052360.015, '20971520']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'default-http-backend', 'exported_namespace': 'infrastructure', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'ingress-default-backend-7df589f6bf-zx5t2'}, 'value': [1516052360.015, '20971520']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-flannel', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-15-60.ec2.internal', 'pod': 'canal-hd4nk'}, 'value': [1516052360.015, '104857600']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-flannel', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-16-146.ec2.internal', 'pod': 'canal-dwvzl'}, 'value': [1516052360.015, '104857600']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-flannel', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-17-110.ec2.internal', 'pod': 'canal-nsddd'}, 'value': [1516052360.015, '104857600']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-flannel', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'canal-jtz99'}, 'value': [1516052360.015, '104857600']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-flannel', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'canal-p4smw'}, 'value': [1516052360.015, '104857600']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-lego', 'exported_namespace': 'infrastructure', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'kube-lego-64f6d4f695-bbs59'}, 'value': [1516052360.015, '268435456']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kube-state-metrics', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'kube-state-metrics-6d465b4b54-w552f'}, 'value': [1516052360.015, '115343360']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubedns', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'kube-dns-7f56f9f8c7-zd69p'}, 'value': [1516052360.015, '178257920']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubedns', 'exported_namespace': 'kube-system', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'kube-dns-7f56f9f8c7-f28sh'}, 'value': [1516052360.015, '178257920']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubernetes-dashboard', 'exported_namespace': 'gawkbox-demo', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-16-146.ec2.internal', 'pod': 'kubernetes-dashboard-7cf4ddccb9-2dgdw'}, 'value': [1516052360.015, '52428800']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubernetes-dashboard', 'exported_namespace': 'gawkbox-dev', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-15-60.ec2.internal', 'pod': 'kubernetes-dashboard-7cf4ddccb9-p8mkc'}, 'value': [1516052360.015, '52428800']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubernetes-dashboard', 'exported_namespace': 'gawkbox-prod', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-17-110.ec2.internal', 'pod': 'kubernetes-dashboard-7cf4ddccb9-pl8rb'}, 'value': [1516052360.015, '52428800']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'kubernetes-dashboard', 'exported_namespace': 'gawkbox-spinnaker', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-17-110.ec2.internal', 'pod': 'kubernetes-dashboard-7cf4ddccb9-2md7v'}, 'value': [1516052360.015, '52428800']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'nginx-ingress-controller', 'exported_namespace': 'infrastructure', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'ingress-controller-598465c54-v7zhx'}, 'value': [1516052360.015, '2097152000']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'node-exporter', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'node-exporter-xtd2c'}, 'value': [1516052360.015, '536870912']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'node-exporter', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'node-exporter-gxsgh'}, 'value': [1516052360.015, '536870912']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'prometheus', 'exported_namespace': 'devops', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-101.ec2.internal', 'pod': 'prometheus-54744d9cdb-4zdv6'}, 'value': [1516052360.015, '8388608000']}, {'metric': {'__name__': 'kube_pod_container_resource_limits_memory_bytes', 'container': 'server', 'exported_namespace': 'infrastructure', 'instance': '100.96.39.71:8080', 'job': 'kube-state-metrics', 'namespace': 'devops', 'node': 'ip-10-151-22-218.ec2.internal', 'pod': 'alb-ingress-controller-7777d769dd-rcsq6'}, 'value': [1516052360.015, '268435456']}]

    def test_find_pods_resource_limits_memory_bytes(self):
        '''Finds the memory bytes value for a given pod'''

        exported_namespace = 'garland'
        node = 'ip-10-151-22-218.ec2.internal'
        pod = 'butterfly-1-nvc2t'

        memory_bytes = src.find.pods_resource_limits_memory_bytes(
                    self.kube_pod_container_resource_limits_memory_dict,
                    exported_namespace,
                    node,
                    pod
                    )

        self.assertEqual(memory_bytes, 262144000)

    def test_find_pods_resource_limits_memory_bytes_no_pod(self):
        '''Finds the memory bytes value for a given pod which does not exist'''

        exported_namespace = 'garland'
        node = 'ip-10-151-22-218.ec2.internal'
        pod = 'foo-bar'

        memory_bytes = src.find.pods_resource_limits_memory_bytes(
                    self.kube_pod_container_resource_limits_memory_dict,
                    exported_namespace,
                    node,
                    pod
                    )

        self.assertEqual(memory_bytes, 1.0000445566)

if __name__ == '__main__':
    unittest.main()
